; PlatformIO Project Configuration File
; VFD Clock with FUTABA 8-MD-06INKM and ESP8266
;
; Build: pio run
; Upload: pio run --target upload
; Monitor: pio device monitor
;
; https://docs.platformio.org/page/projectconf.html

; =============================================================================
; Common settings shared across environments
; =============================================================================
[platformio]
default_envs = esp8266
src_dir = src
lib_dir = lib
include_dir = include
test_dir = test

[common]
monitor_speed = 9600
upload_speed = 9600

build_flags = 
    -D DEBUG_ESP_PORT=Serial
    -D WIFI_SSID=\"your_ssid\"
    -D WIFI_PASSWORD=\"your_password\"

; =============================================================================
; Project Dependencies
; =============================================================================
; All libraries with pinned versions for reproducible builds
lib_deps =
    ; NTP Client for time synchronization
    arduino-libraries/NTPClient@^3.2.1
    
    ; ESP8266 WiFi (bundled with platform, listed for reference)
    ; ESP8266WiFi
    
    ; ArduinoJson for future web config features
    bblanchon/ArduinoJson@^7.0.0
    
    ; Time library for advanced time handling
    paulstoffregen/Time@^1.6.1
    
    ; DS3231 RTC support
    adafruit/RTClib@^2.1.0

; =============================================================================
; ESP8266 NodeMCU v2 (Main Target)
; =============================================================================
[env:esp8266]
platform = espressif8266@^4.2.0
board = nodemcuv2
framework = arduino

monitor_speed = ${common.monitor_speed}
upload_speed = ${common.upload_speed}

build_flags = 
    ${common.build_flags}
    -D ARDUINO_ESP8266_NODEMCU_V2

lib_deps = ${common.lib_deps}

board_build.filesystem = littlefs
test_ignore = test_native_*

; Upload settings (uncomment and adjust for your port)
; upload_port = /dev/cu.usbserial-*
; upload_port = COM3

; =============================================================================
; ESP8266 Wemos D1 Mini (Alternative Board)
; =============================================================================
[env:d1_mini]
platform = espressif8266@^4.2.0
board = d1_mini
framework = arduino

monitor_speed = ${common.monitor_speed}
upload_speed = ${common.upload_speed}

build_flags = 
    ${common.build_flags}
    -D ARDUINO_ESP8266_WEMOS_D1MINI

lib_deps = ${common.lib_deps}
test_ignore = test_native_*

; =============================================================================
; Debug Environment (slower upload, more verbose)
; =============================================================================
[env:debug]
platform = espressif8266@^4.2.0
board = nodemcuv2
framework = arduino

monitor_speed = ${common.monitor_speed}
upload_speed = 115200

build_type = debug
build_flags = 
    ${common.build_flags}
    -D DEBUG=1
    -D DEBUG_ESP_WIFI
    -D DEBUG_ESP_HTTP_CLIENT

lib_deps = ${common.lib_deps}
test_ignore = test_native_*

; =============================================================================
; ESP8266 with MAX7219 LED Matrix Display
; =============================================================================
; Build with: pio run -e esp8266_max7219
[env:esp8266_max7219]
platform = espressif8266@^4.2.0
board = nodemcuv2
framework = arduino

monitor_speed = ${common.monitor_speed}
upload_speed = ${common.upload_speed}

build_flags = 
    ${common.build_flags}
    -D ARDUINO_ESP8266_NODEMCU_V2
    -D USE_MAX7219_DISPLAY

lib_deps = ${common.lib_deps}

board_build.filesystem = littlefs
test_ignore = test_native_*

; =============================================================================
; Native Desktop Environment (for logic testing)
; =============================================================================
[env:native]
platform = native
test_framework = unity
test_build_src = yes
build_src_filter = +<config_manager.cpp> +<weather_parser.cpp>
build_flags = -D NATIVE_TEST -std=c++11
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
    fabiobatsilva/ArduinoFake@^0.4.0
test_ignore = test_config, test_weather, test_time
